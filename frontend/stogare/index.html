<!DOCTYPE html>
<html>
<head>
    <title>Test Storage Service</title>
</head>
<body>
    <h1>Upload File</h1>
    <input type="file" id="fileInput" />
    <button onclick="uploadFile()">Upload</button>

    <h2>Files in Database</h2>
    <button onclick="listFilesDB()">Refresh List</button>
    <ul id="fileList"></ul>

    <script>
        const API_URL = "http://127.0.0.1:8002";

        async function uploadFile() {
            const fileInput = document.getElementById("fileInput");
            if (!fileInput.files.length) return alert("Chọn file trước!");

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);

            try {
                const res = await fetch(`${API_URL}/upload/`, {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();
                alert("Upload thành công: " + data.filename);
                listFilesDB();
            } catch (err) {
                console.error(err);
                alert("Upload thất bại");
            }
        }

        async function listFilesDB() {
            try {
                const res = await fetch(`${API_URL}/files/db/`);
                const files = await res.json();
                const ul = document.getElementById("fileList");
                ul.innerHTML = "";
                files.forEach(f => {
                    const li = document.createElement("li");
                    li.innerHTML = `<a href="${API_URL}/files/${f.filename}" target="_blank">${f.filename}</a> - ${f.content_type} - ${f.uploaded_at}`;
                    ul.appendChild(li);
                });
            } catch (err) {
                console.error(err);
                alert("Không lấy được danh sách file");
            }
        }

        listFilesDB(); // Load danh sách file khi mở web
    </script>
</body>
</html>
